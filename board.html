<html>
 <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js"></script>
  <title>Falconboard</title>
  <script id="post-template" type="text/x-handlebars-template">
   <article>
{{#if parent}}
    Id: {{_id}}
{{else}}
    Id: <a href="/{{board}}/{{_id}}/">{{_id}}</a>
{{/if}}
    Email: {{email}}
{{#if image}}
    Image: <img src="{{image}}"></img>
{{else if image_link}}
    Image: <a href="{{image_link}}">{{image_link}}</a>
{{/if}}
    Text: {{text}}
   </article>
  </script>
  <script lang="javascript">
   var post_template = Handlebars.compile($("#post-template").html());
  </script>
 </head> 
 <body>
  <style>
   article > a::before { content: "THREAD "; background: black; color: green; }
  </style>
  <main>
   <div id="posts">
   </div>
   <form action="" method="post">
    Email: <input type="text" name="email" id="email"></input><br />
    Image: <input type="text" name="image" id="image"></input><br />
    Text: <textarea name="text" id="text"></textarea><br />
    <button type="submit" name="submit" value="Send"></button>
   </form>
  <script lang="javascript">
$(document).ready(function(){
 var path = "/_api" + window.location.pathname;
 var board = window.location.pathname.slice(1, window.location.pathname.slice(1).indexOf('/') + 1);
 var boardpath = window.location.pathname.slice(("/" + board + "/").length);
 $("#posts").html("browsing <a href=\"/" + board + "/\">/" + board + "/</a>" + boardpath);
 //$("form").attr("action", path);
 $("form").submit(function(event) {
  req = {"email": $("#email").val(), "image": $("#image").val(), "text": $("#text").val()};
  if (req["email"] != "" || req["text"] != "") {
   ajax = $.ajax({
    type: "POST",
    url: path,
    data: JSON.stringify(req),
    contentType: "application/json; charset=utf-8"
   });
   ajax.done(function(data, textStatus, request) {
    document.location.href = request.getResponseHeader("Location");
   });
   ajax.fail(function(xhr, status) {
    alert(status);
   });
  }
  event.preventDefault();
 });
 var jqxhr = $.ajax(path)
  .done(function(data) {
    //var text = JSON.stringify(data);
    //alert(text);
    for (var i = 0; i < data.length; i++) {
     var post = data[i];
     post["board"] = board;
     $("#posts").append(post_template(post));
    }
  })
  .fail(function(xhr, status) {
    alert(status);
  })
});
  </script>
  <h4>Also, send me your BTC to 12V5pw2R5TKMj1RJF3TgcenXPQQ7vhkwk1</h4>
 </body>
</html>
