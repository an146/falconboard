<!DOCTYPE html>
<html lang="en">
 <head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js"></script>
  <title>Falconboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/pygments.css" rel="stylesheet">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script id="post-template" type="text/x-handlebars-template">
  <div class="row">
   <article>
{{#if parent}}
    {{_id}}
{{else}}
    <a href="/{{board}}/{{_id}}/" class="threadlink">{{_id}}</a>
{{/if}}
    {{email}}
{{#if image}}
    <img src="{{image}}"></img>
{{else if image_link}}
    <a href="{{image_link}}">{{image_link}}</a>
{{/if}}
    {{{html}}}
{{#if admin}}
    <a href="/_api/{{board}}/{{_id}}/delete/">Delete</a>
{{/if}}
   </article>
  </div>
  </script>
  <script lang="javascript">
   var post_template = Handlebars.compile($("#post-template").html());
  </script>
 </head> 
 <body>
  <style>
   img { max-width: 1299px; }
   article > a.threadlink::before { content: "THREAD "; background: black; color: green; }
   p { display: inline }
  </style>
  <main>
   <div class="container-fluid">
     <div id="posts">
     </div>
     <div class="row">
      <div class="form-group">
       <form action="" method="post">
        Email: <input class="form-control" type="text" name="email" id="email"></input><br />
        Image: <input class="form-control" type="text" name="image" id="image"></input><br />
        Text: <textarea class="form-control" name="text" id="text"></textarea><br />
        <button class="form-control" type="submit" name="submit" value="Send">Send</button>
       </form>
      </div>
     </div>
   </div>
  <script lang="javascript">
$(document).ready(function(){
 var path = "/_api" + window.location.pathname;
 var board = window.location.pathname.slice(1, window.location.pathname.slice(1).indexOf('/') + 1);
 var boardpath = window.location.pathname.slice(("/" + board + "/").length);
 $("#posts").html("browsing <a href=\"/" + board + "/\">/" + board + "/</a>" + boardpath + ". <a href=\"https://falconboard.net.ru/\">Index</a>");
 //$("form").attr("action", path);
 $("form").submit(function(event) {
  req = {"email": $("#email").val(), "image": $("#image").val(), "text": $("#text").val()};
  if (req["email"] != "" || req["text"] != "") {
   ajax = $.ajax({
    type: "POST",
    url: path,
    data: JSON.stringify(req),
    contentType: "application/json; charset=utf-8"
   });
   ajax.done(function(data, textStatus, request) {
    document.location.href = request.getResponseHeader("Location");
   });
   ajax.fail(function(xhr, status) {
    alert(status);
   });
  }
  event.preventDefault();
 });
 var jqxhr = $.ajax(path)
  .done(function(data) {
    //var text = JSON.stringify(data);
    //alert(text);
    for (var i = 0; i < data.length; i++) {
     var post = data[i];
     post["board"] = board;
     post["admin"] = (document.cookie.indexOf('admin_session') >= 0);
     $("#posts").append(post_template(post));
    }
  })
  .fail(function(xhr, status) {
    alert(status);
  })
});
  </script>
  <h4>Also, send me your BTC to 12V5pw2R5TKMj1RJF3TgcenXPQQ7vhkwk1</h4>
 </body>
</html>
